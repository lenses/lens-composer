<link rel="import" href="../polymer/polymer.html"> 
<link rel="import" href="lens-node.html"> 

<!--

A component used to create new lenses, by connecting components and passing data through them.

Example:

    <lens-composer></lens-composer>

@demo
-->

<dom-module id="lens-composer">
    <style>
      :host {
        display: block;
      }


    </style>
    <template>
      <template is="dom-repeat" items="{{nodes}}" as="node">

        <lens-node id="{{node.id}}" type="{{node.type}}"></lens-node>
      </template>
    </template>
  
  <script>
    Polymer({
      is: 'lens-composer',
      properties: {
        /**
         * prevState is an object containing data required to rebuild a lens.
         * Example:
         *   {
         *     nodes: [{ 'type': 'input', 'id':'lens-node-0',  'componentName': 'lens-viz-g-bar'}],
         *   }
         * @type {Object}
         */
        prevState: {
          type: Object,
          value: function(){ return {     nodes: [
              { 'type': 'input', 'id':'lens-node-0',  'componentName': 'lens-viz-g-bar'},
              { 'type': 'transform', 'id':'lens-node-1',  'componentName': 'lens-viz-g-bar'}
            ] }; }
        },
        nodes: {
          type: Array,
          value: function(){ return []; }
        },
        // INITIALIZE PRIVATE
        _uniqueCounter: {
          type: Number,
          value: 0
        }
        
      },
      listeners: {

      },
      attached: function(){
        if (this.prevState){
          this.loadLens(this.prevState);
        }

      },
      loadLens: function(lensData){
        var self = this;
        // this.nodes = lensData.nodes;
        lensData.nodes.forEach(function(node){
          // var newNode = self.createNode(node.type, node.id);
          
          // node.id = newNode.id;
          self.push('nodes', node);

        })

        console.log(this.nodes);


        // Recreate a lens given the data.
      },
      clearLens: function(){
        // Wipe the slate clean and start from scratch
      },
      addNewComponent: function(){
        // Adds a new external component to the list
      },
      createNode: function(type, id, track){
        // Creates a new lens-node
        var newNode = document.createElement('lens-node');

        newNode.id = id || this._generateUniqueId('lens-node');
        newNode.type = type;
        this.appendChild(newNode);
        
        return newNode;

      },
      addNode: function(){

      },
      deleteNode: function(){
        // Deletes a lens-node
      },
      connectNodes: function(){
        // Connects I/O of nodes 
      },
      _generateUniqueId: function(elName){
        // Generates a unique id for lens-node
        var uniqueId = elName + '-' + this._uniqueCounter;
        
        this._uniqueCounter+= 1;

        return uniqueId;
      }
     
    });
  </script>
</dom-module>