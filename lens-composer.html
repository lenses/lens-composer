<link rel="import" href="lens-node.html">
<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../th-theme/th-theme.html">
<link rel="import" href="../core-ajax/core-ajax.html">
<link rel="import" href="../core-icons/image-icons.html">
<link rel="import" href="../core-icons/editor-icons.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../paper-dropdown/paper-dropdown.html">


<polymer-element name="lens-composer" attributes="componentList lensTitle lensAuthor theme prevState output">
  <core-style ref="theme"></theme>
  <template>
    <link rel="stylesheet" href="lens-composer.css">

    <!-- HEADER -->
    <div id="nav">
      <div id="lens-info" class="center horizontal layout flex">
        <p class="title">Title</p>
        <p>Author</p>
      </div>
      <div id="save" class="center horizontal layout">
        <img class="icon" src="assets/publish.png" width="50%">
      </div>
    </div>

    <!-- TRACKS -->
    <div id="control-panel" class="padded">
    </div>

    <!-- MAIN FRAME -->
    <div id="main">
      <!-- Other things here --> 

      <!-- lens-node here -->
      <template repeat="{{node, index in nodes}}">
        <div id="node-container" class="{{_isActive(node)}}">
          <content select="#{{node.id}}"></content>
        </div>
      </template>
      
    </div>

  
  </template>
  
  <script>

      Polymer('lens-composer', {
        // lensTitle: 'Example Lens',
        // lensAuthor: 'Nisha Batra',
        // theme: 'lenses',
        _uniqueCounter: 0,
        _numTracks: 0,
        // _scrollOptions: {
        //   speed: 800, // Integer. How fast to complete the scroll in milliseconds
        //   easing: 'easeInOutCubic', // Easing pattern to use
        //   updateURL: false, // Boolean. Whether or not to update the URL with the anchor hash on scroll
        //   offset: 85 // Pixels by which to offset the anchor to the top of the screen
        // },
        output: [],
        nodes: [],
        observe: {
          prevState: 'loadLens',
          theme: "updateTheme"
        },
        componentList: [
          {name:'lens-data-table', friendly: 'Data table', type: 'input'},
          {name:'lens-input-simple-api', friendly: 'API Data Loader', type: 'input'},
          {name:'lens-input-csv', friendly: 'CSV Loader', type: 'input'},
          {name:'lens-input-enigma', friendly: 'Enigma Data Loader', type: 'input'},
          
          {name:'lens-data-find-replace', friendly: 'Find and Replace', type: 'transform'},
          {name:'lens-data-convert-date', friendly: 'Convert Date Formats', type: 'transform'},
          {name:'lens-data-geocoder-firebase', friendly: 'Geocodes for Map', type: 'transform'},
          {name:'lens-data-groupby', friendly: 'Group Data', type: 'transform'},
          {name:'lens-data-filter', friendly: 'Filter Data', type: 'transform'},
          {name:'lens-data-sort', friendly: 'Sort Data', type: 'transform'},
          {name:'lens-data-split', friendly: 'Split Column', type: 'transform'},
          {name:'lens-data-join', friendly: 'Join Columns', type: 'transform'},
          {name:'lens-data-formula', friendly: 'Math & Trig Functions', type: 'transform'},
          {name:'lens-data-array-func', friendly: 'Map/Reduce Function (JavaScript)', type: 'transform'},

          {name:'lens-data-zip', friendly: 'Join Tracks', type: 'join'},

          {name:'lens-viz-am-combo-chart', friendly: 'Bar/Line Combo Chart', type: 'visualize'},
          {name:'lens-viz-g-map', friendly: 'Google Map', type: 'visualize'},
          {name:'lens-viz-mapbox', friendly: 'Mapbox Map', type: 'visualize'},
          {name:'lens-viz-g-bar-chart', friendly: 'Google Bar Chart', type: 'visualize'},
          {name:'lens-viz-g-line-chart', friendly: 'Google Line Graph', type: 'visualize'},
          {name:'lens-viz-g-scatter-bubble', friendly: 'Google Bubble Chart', type: 'visualize'},
          {name:'lens-viz-g-pie-chart', friendly: 'Google Pie Chart', type: 'visualize'}
          // {name:'lens-viz-line-chart-touch', friendly: 'Thelma Line Chart', type: 'visualize'},
          // {name:'lens-viz-bar-chart-horizontal', friendly: 'Thelma Horizontal Bar Chart', type: 'visualize'},
          // {name:'lens-viz-bar-chart', friendly: 'Thelma Bar Chart', type: 'visualize'}
        ],
        ready: function(){
          var self = this;

          self.fire('lens-composer-ready', self)
          self.themes = window.Themes;
          self.themeNames = Object.keys(self.themes);
          
          if (self.prevState){
            self.loadLens(self.prevState);
          }

          self.addEventListener('lens-join', function(e){
            var res = e.detail,
                track = self.tracks[res.joinFromTrackIndex];
                joinToNodeId = res.joinToNodeId,
                joinFromNodeId = track[track.length - 1].id;
            
            self._getJoinPosition(joinFromNodeId, joinToNodeId);
          })

          window.addEventListener('resize',function(){
            self.updateJoins();
          })

          self.addEventListener('lens-node-output-changed', function(e){
            self._connectNodes();
            self.setOutput();
          })

        },
        updateTheme: function(){
          window.CoreStyle.g.theme = this.theme ? Themes[this.theme] : window.CoreStyle.g.theme;

          this.fire("th-theme-changed", this.theme);
        },
        _createNewNode: function(name, type, id, track){
        
        },
        _addNode: function(e, detail, selection){
        
        },
        _deleteNode: function(e, detail, selection){
      
        },
        _connectNodes: function(){

        },
        _expandSelected: function(e, detail, selection){
      
          
        },
        _expandNodes: function(e){
         
        },
        _collapseNodes: function(e){
         
        },
        generateUniqueId: function(elName){
          
        },
        deselectFinalResultAll: function(){
        
        },
        _selectDefaultFinalResult: function(){
        
        },
        dumpData: function(){
        
     
        },
        setOutput: function(){
          
        },

        loadLens: function(){
       
            
        },
        resetLens: function(){
          
        },
        _parseNodes: function(){
          
        },
        buildNodes: function(nodes){
    

        },
        getFinalResult: function(){
    
        },
        collapseFilter: function(node){
        },
        _addTrack: function(e, detail, selection){
       
        },
        _deleteTrack: function(trackNum){
          
          
        },
        _addComponentInfoToNode: function(node){
          
        },
        _removeHTMLfromNode: function(node){
        },
        _getComponentState: function(component){
          
        },
        _getComponentStateMinimal: function(component){
          
        },
        _setUniqueCounter: function(){
      
        },
        _calculateTrackShift: function(tracks){
         
        },
        _calculateNodeShift: function(opened, track){
         
          
        },
        _scrollToNode: function(nodeId){
         
        },
        _getJoinPosition: function(joinFromNodeId, joinToNodeId){
      
        },
        _getJoinStyles: function(joinObj){

        
        },
        updateJoins: function(){
        
        },
        resizeComponent: function(e, detail, selection){
        
        },
        _isActive: function(node){
          if (node && node.active){
            return "";
          } else {
            return "hidden";
          }
        }
      });

  </script>
</polymer-element>
